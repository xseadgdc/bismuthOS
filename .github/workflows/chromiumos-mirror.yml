name: Mirror ChromiumOS Source to GitHub
on:
  workflow_dispatch: # Allows you to start the process manually

jobs:
  mirror_repository:
    runs-on: ubuntu-latest
    steps:
      - name: Mirror Google Source to GitHub        
        env:
          # Use env to safely pass the repo path into the shell
          REPO_PATH: ${{ github.repository }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}      
        run: |
          # 1. Clone the source as a bare mirror (metadata only, no working files)
          git clone --mirror "https://chromium.googlesource.com/chromiumos" chromiumos-mirror
          cd chromiumos-mirror
          
          # 2. Add remote with correctly formatted authenticated URL
          git remote add github "https://x-access-token:${GH_TOKEN}@github.com/${REPO_PATH}.git"
          
          # 3. Force push to overwrite the current repo with the mirror
          git push --mirror github
