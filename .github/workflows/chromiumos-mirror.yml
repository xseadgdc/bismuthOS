name: Mirror ChromiumOS Source to GitHub
on:
  workflow_dispatch: # Allows you to start the process manually

jobs:
  mirror_repository:
    runs-on: ubuntu-latest
    # Explicitly grant write access to the job
    permissions:
      contents: write 
    steps:
      - name: Hard-Fork Mirror       
        env:
          # Use env to safely pass the repo path into the shell
          REPO_PATH: ${{ github.repository }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}      
        run: |
          # 1. Bare clone from Google
          git clone --mirror "https://chromium.googlesource.com/chromiumos/manifest.git" temp-repo
          cd temp-repo
          
          # 2. Add authenticated GitHub remote
          git remote add github "https://x-access-token:${GH_TOKEN}@github.com/${REPO_PATH}.git"
          
          # 3. Targeted Push
          # This pushes all branches and tags from Google to your repo.
          # If it fails on the 'main' or 'master' branch, it's because that branch is PROTECTED.
          git push github --all --force
          git push github --tags --force
