name: Bulk Fork Components
on: 
  workflow_dispatch:
    inputs:
      limit:
        description: 'Number of repos to fork (e.g., 5)'
        required: true
        default: '5'

jobs:
  fork_repos:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - name: Parse and Mirror
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 1. Extract the first X repository names from the manifest
          REPOS=$(grep -oP 'name="\K[^"]+' default.xml | head -n ${{ github.event.inputs.limit }})
          
          for REPO in $REPOS; do
            NAME=$(echo $REPO | sed 's/\//-/g') # Replace slashes for GitHub names
            echo "Processing $REPO as $NAME..."
            
            # 2. Create the target repo on your GitHub account if it doesn't exist
            gh repo create "$NAME" --public || echo "Repo already exists"
            
            # 3. Mirror from Google directly to the new GitHub repo
            git clone --mirror https://chromium.googlesource.com/chromium/src.git temp-dir
            cd temp-dir
            git remote add github "https://x-access-token:${GH_TOKEN}@github.com{{ github.repository_owner }}/$NAME.git"
            git push --mirror github
            cd .. && rm -rf temp-dir
          done  
